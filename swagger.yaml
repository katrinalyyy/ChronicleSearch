openapi: 3.0.0
info:
  title: ChronicleSearch API
  description: API для работы с хрониками и заявками на исследования
  version: 1.0.0
servers:
  - url: http://localhost:8080/api
    description: Development server

paths:
  # Chronicle Resources (7 endpoints)
  /chronicle-resources:
    get:
      summary: Получить список хроник с фильтрацией
      parameters:
        - name: title
          in: query
          schema:
            type: string
        - name: author
          in: query
          schema:
            type: string
        - name: location
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Список хроник
    post:
      summary: Создать новую хронику
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChronicleResource'
      responses:
        '201':
          description: Хроника создана

  /chronicle-resources/{id}:
    get:
      summary: Получить хронику по ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Хроника найдена
    put:
      summary: Обновить хронику
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChronicleResource'
      responses:
        '200':
          description: Хроника обновлена
    delete:
      summary: Удалить хронику
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Хроника удалена

  /chronicle-resources/{id}/image:
    post:
      summary: Загрузить изображение хроники
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        '200':
          description: Изображение загружено

  /chronicle-resources/{id}/add-to-request:
    post:
      summary: Добавить хронику в заявку-черновик
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Хроника добавлена в заявку

  # Requests (7 endpoints)
  /requests/draft-info:
    get:
      summary: Получить информацию о черновике заявки
      responses:
        '200':
          description: Информация о черновике

  /requests:
    get:
      summary: Получить список заявок с фильтрацией
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: date_from
          in: query
          schema:
            type: string
            format: date
        - name: date_to
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Список заявок

  /requests/{id}:
    get:
      summary: Получить заявку с хрониками
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Заявка найдена
    put:
      summary: Обновить поля заявки
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestChronicleResearch'
      responses:
        '200':
          description: Заявка обновлена
    delete:
      summary: Удалить заявку
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Заявка удалена

  /requests/{id}/form:
    put:
      summary: Сформировать заявку
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Заявка сформирована

  /requests/{id}/complete-or-reject:
    put:
      summary: Завершить или отклонить заявку
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
                  enum: [complete, reject]
      responses:
        '200':
          description: Заявка обработана

  # Chronicle Research (2 endpoints)
  /chronicle-research/{id}/chronicles/{chronicle_id}:
    put:
      summary: Обновить связь хроники в заявке
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: chronicle_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                quote:
                  type: string
                is_matched:
                  type: boolean
      responses:
        '200':
          description: Связь обновлена
    delete:
      summary: Удалить хронику из заявки
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: chronicle_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Хроника удалена из заявки

  # Users (5 endpoints)
  /users/register:
    post:
      summary: Регистрация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: Пользователь зарегистрирован

  /users/auth:
    post:
      summary: Аутентификация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Успешная аутентификация

  /users/logout:
    post:
      summary: Выход из системы
      responses:
        '200':
          description: Успешный выход

  /users/profile:
    get:
      summary: Получить профиль пользователя
      responses:
        '200':
          description: Профиль пользователя
    put:
      summary: Обновить профиль пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: Профиль обновлен

components:
  schemas:
    ChronicleResource:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        author:
          type: string
        location:
          type: string
        image:
          type: string
        created_at:
          type: string
          format: date-time

    RequestChronicleResearch:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        search_event:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        formed_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        is_moderator:
          type: boolean



